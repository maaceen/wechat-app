Page({
  data: {
    questions: [
      {
        id: 1,
        type: 'single',
        question: '以下哪种加密算法属于非对称加密？',
        options: ['AES', 'DES', 'RSA', 'RC4'],
        answer: [2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 3,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 4,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 5,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 6,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 7,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 8,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 9,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 10,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 11,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 12,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 13,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 14,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 15,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 16,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 17,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      },
      {
        id: 2,
        type: 'multi',
        question: '下列哪些属于网络攻击类型？（多选）',
        options: ['DDoS攻击', 'SQL注入', 'ARP欺骗', '数据加密'],
        answer: [0,1,2]
      }
      
    ],
    currentIndex: 0,
    minutes: 30,
    seconds: 0,
    selectedAnswers: {},
    swiperHeight: 600
  },

  onLoad() {
    // 动态计算swiper高度
    this.calcSwiperHeight()
    this.startTimer()
  },

  // 计算swiper高度
  calcSwiperHeight() {
    const sysInfo = wx.getSystemInfoSync()
    const query = wx.createSelectorQuery()
    query.select('.header').boundingClientRect()
    query.select('.footer').boundingClientRect()
    query.exec(res => {
      const headerH = res[0].height
      const footerH = res[1].height
      this.setData({
        swiperHeight: (sysInfo.windowHeight - headerH - footerH) * 2
      })
    })
  },

  // // 启动倒计时
  // startTimer() {
  //   setInterval(() => {
  //     let { minutes, seconds } = this.data
  //     if (seconds === 0) {
  //       if (minutes === 0) return this.autoSubmit()
  //       minutes--
  //       seconds = 59
  //     } else {
  //       seconds--
  //     }
  //     this.setData({ minutes, seconds })
  //   }, 1000)
  // },

  // 选择答案
  selectOption(e) {
    const { qindex, oid } = e.currentTarget.dataset
    const question = this.data.questions[qindex]
    const selected = this.data.selectedAnswers[qindex] || []
    
    let newSelected = []
    if (question.type === 'single') {
      newSelected = [oid]
    } else {
      newSelected = selected.includes(oid) 
        ? selected.filter(i => i !== oid) 
        : [...selected, oid]
    }

    this.setData({
      [`selectedAnswers[${qindex}]`]: newSelected
    })
  },

  // 题目切换
  swiperChange(e) {
    this.setData({ currentIndex: e.detail.current })
  },
  prevQuestion() {
    this.setData({ currentIndex: Math.max(0, this.data.currentIndex - 1) })
  },
  nextQuestion() {
    this.setData({ currentIndex: Math.min(this.data.questions.length - 1, this.data.currentIndex + 1) })
  },

  // 交卷逻辑
  submitExam() {
    wx.showModal({
      title: '确认交卷',
      content: '是否确认提交考试答卷？',
      success: (res) => {
        if (res.confirm) {
          // 跳转到结果页面
          wx.navigateTo({
            url: '/pages/result/result'
          })
        }
      }
    })
  }
})